server:
  port: ${SERVER_PORT:8080}

spring:
  application:
    name: springai-agent-platform
  config:
    import:
      - optional:file:./application.yml
      - optional:file:/opt/application.yml
  ai:
    openai:
      api-key: ${OPENAI_API_KEY:dummy-openai-key}

agent:
  catalog:
    external-dir: ${AGENT_EXTERNAL_DIR:agents}
    refresh-interval-ms: ${AGENT_REFRESH_INTERVAL_MS:10000}
  viewport:
    external-dir: ${AGENT_VIEWPORT_EXTERNAL_DIR:viewports}
    refresh-interval-ms: ${AGENT_VIEWPORT_REFRESH_INTERVAL_MS:30000}
  data:
    external-dir: ${AGENT_DATA_EXTERNAL_DIR:data}
  capability:
    tools-external-dir: ${AGENT_TOOLS_EXTERNAL_DIR:tools}
    refresh-interval-ms: ${AGENT_CAPABILITY_REFRESH_INTERVAL_MS:30000}
  skill:
    external-dir: ${AGENT_SKILL_EXTERNAL_DIR:skills}
    refresh-interval-ms: ${AGENT_SKILL_REFRESH_INTERVAL_MS:30000}
    max-prompt-chars: ${AGENT_SKILL_MAX_PROMPT_CHARS:8000}
  model:
    external-dir: ${AGENT_MODEL_EXTERNAL_DIR:models}
    refresh-interval-ms: ${AGENT_MODEL_REFRESH_INTERVAL_MS:30000}
  llm:
    interaction-log:
      enabled: ${AGENT_LLM_INTERACTION_LOG_ENABLED:true}
      mask-sensitive: ${AGENT_LLM_INTERACTION_LOG_MASK_SENSITIVE:true}
  tools:
    frontend:
      submit-timeout-ms: ${AGENT_TOOLS_FRONTEND_SUBMIT_TIMEOUT_MS:300000}
    agent-file-create:
      default-system-prompt: ${AGENT_TOOLS_AGENT_FILE_CREATE_DEFAULT_SYSTEM_PROMPT:你是通用助理，回答要清晰和可执行。}
    bash:
      # Baseline defaults live here; concrete local whitelist is recommended in application.yml.
      # If AGENT_BASH_ALLOWED_COMMANDS is empty, _bash_ will reject all commands.
      working-directory: ${AGENT_BASH_WORKING_DIRECTORY:${user.dir}}
      allowed-paths: ${AGENT_BASH_ALLOWED_PATHS:${user.dir},/tmp}
      allowed-commands: ${AGENT_BASH_ALLOWED_COMMANDS:ls,pwd,cat,head,tail,top,free,df,git,rg,find}
      path-checked-commands: ${AGENT_BASH_PATH_CHECKED_COMMANDS:ls,cat,head,tail,git,rg,find}
      shell-features-enabled: ${AGENT_BASH_SHELL_FEATURES_ENABLED:false}
      shell-executable: ${AGENT_BASH_SHELL_EXECUTABLE:bash}
      shell-timeout-ms: ${AGENT_BASH_SHELL_TIMEOUT_MS:10000}
      max-command-chars: ${AGENT_BASH_MAX_COMMAND_CHARS:16000}
  auth:
    enabled: ${AGENT_AUTH_ENABLED:true}
    jwks-uri: ${AGENT_AUTH_JWKS_URI:}
    issuer: ${AGENT_AUTH_ISSUER:}
    jwks-cache-seconds: ${AGENT_AUTH_JWKS_CACHE_SECONDS:}
    # Example local key in PEM format:
    # local-public-key: |
    #   -----BEGIN PUBLIC KEY-----
    #   MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtesttesttesttesttest
    #   testtesttesttesttesttesttesttesttesttesttesttesttesttesttesttest
    #   testtesttesttesttesttesttesttesttesttesttesttesttesttesttesttest
    #   -----END PUBLIC KEY-----
  cors:
    enabled: false
    path-pattern: /api/**
    allowed-origin-patterns:
      - http://localhost:8081
    allowed-methods:
      - GET
      - POST
      - PUT
      - PATCH
      - DELETE
      - OPTIONS
    allowed-headers:
      - "*"
    exposed-headers:
      - Content-Type
    allow-credentials: false
    max-age-seconds: 3600
  chat-image-token:
    secret: ${CHAT_IMAGE_TOKEN_SECRET:}
    previous-secrets: ${CHAT_IMAGE_TOKEN_PREVIOUS_SECRETS:}
    ttl-seconds: ${CHAT_IMAGE_TOKEN_TTL_SECONDS:86400}

memory:
  chat:
    dir: ${MEMORY_CHAT_DIR:./chats}
    k: ${MEMORY_CHAT_K:20}
    charset: ${MEMORY_CHAT_CHARSET:UTF-8}
    action-tools: ${MEMORY_CHAT_ACTION_TOOLS:}

logging:
  level:
    root: INFO
    com.linlay.agentplatform: INFO
    com.linlay.agentplatform.service.LlmService: DEBUG
    com.linlay.agentplatform.service.OpenAiCompatibleSseClient: DEBUG
    com.linlay.agentplatform.service.LlmCallLogger: DEBUG
    com.linlay.agentplatform.llm.wiretap: DEBUG
